<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Saathi Rooms - Ehsaas</title>

    <!-- Lumen Navbar Styles -->
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      #cometchat {
        flex: 1;
        height: calc(100vh - 80px); /* adjust for navbar height */
        margin-top: 80px;
      }

      /* Your provided Lumen-inspired navbar CSS */
      :root {
        --lumen-primary: #5e56e8;
        --lumen-secondary: #7b73ff;
        --lumen-accent: #ff6b6b;
        --lumen-light: #f8f7ff;
        --lumen-dark: #2e2a5c;
        --lumen-text: #4a4a4a;
      }

      .navbar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 5%;
        background-color: white;
        box-shadow: 0 2px 15px rgba(94, 86, 232, 0.1);
        z-index: 1000;
        transition: all 0.3s ease;
      }

      .navbar:hover {
        box-shadow: 0 5px 25px rgba(94, 86, 232, 0.15);
      }

      .logo {
        font-size: 28px;
        font-weight: 700;
        color: var(--lumen-primary);
        text-decoration: none;
        display: flex;
        align-items: center;
      }

      .logo span {
        color: var(--lumen-accent);
      }

      .nav-links {
        display: flex;
        gap: 30px;
      }

      .nav-links a {
        position: relative;
        text-decoration: none;
        color: var(--lumen-text);
        font-weight: 500;
        font-size: 16px;
        transition: all 0.3s ease;
        padding: 5px 0;
      }

      .nav-links a::before {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0;
        height: 2px;
        background: var(--lumen-primary);
        transition: width 0.3s ease;
      }

      .nav-links a:hover {
        color: var(--lumen-primary);
      }

      .nav-links a:hover::before {
        width: 100%;
      }

      .auth-buttons {
        display: flex;
        gap: 15px;
      }

      .nav-btn {
        padding: 10px 22px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .login-btn {
        background: transparent;
        border: 1px solid var(--lumen-primary);
        color: var(--lumen-primary);
      }

      .login-btn:hover {
        background: rgba(94, 86, 232, 0.05);
      }

      .signup-btn {
        background: var(--lumen-primary);
        border: 1px solid var(--lumen-primary);
        color: white;
      }

      .signup-btn:hover {
        background: var(--lumen-secondary);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(94, 86, 232, 0.2);
      }

      .mobile-menu-btn {
        display: none;
        background: none;
        border: none;
        font-size: 24px;
        color: var(--lumen-primary);
        cursor: pointer;
      }

      @media (max-width: 768px) {
        .nav-links,
        .auth-buttons {
          display: none;
        }

        .mobile-menu-btn {
          display: block;
        }

        .navbar {
          padding: 15px 5%;
        }
      }
    </style>
  </head>

  <body>
    <!-- Navbar Inserted Here -->
    <nav class="navbar">
      <a href="./index.html" class="logo">Ehsaas<span>.</span></a>

      <button class="mobile-menu-btn">☰</button>

      <div class="nav-links" id="navLinks">
        <a href="mood.html">MOOD AI</a>
        <a href="sleep.html">SLEEP WELL</a>
        <a href="stress.html">DESTRESS</a>
        <a href="./saathi.html">SAATHI ROOMS</a>
        <a href="x.html">CHILL ZONE</a>
        <a href="find_my_therapist.html">NEED HELP?</a>
        <a href="ecom.html">MIND MART</a>
        <a href="sleeptrack.html">TRACK SLEEP</a>
    </div>

                  <!-- Added id "authButtons" to allow JS targeting -->
    <div class="auth-buttons" id="authButtons">
        <button class="nav-btn login-btn" id="loginBtn" onclick="window.location.href='login.html'">Log in</button>
        <button class="nav-btn signup-btn" id="signupBtn" onclick="window.location.href='signup.html'">Get Started</button>
        <a href="welcome_board.html"><button class="nav-btn signup-btn" id="dashboard">Dashboard</button></a>
        <button class="nav-btn login-btn " id="logoutBtn" onclick="window.location.href='logout.html'">Log out</button>

    </div>
    
    <script>
      // Function to update the navbar based on user auth status
      const user = localStorage.getItem("userCredential");
      const authButtons = document.getElementById("authButtons");
        const isLoggedIn = sessionStorage.getItem('isLoggedIn');
        document.addEventListener('DOMContentLoaded', function () {
    const loginBtn = document.getElementById('loginBtn');
    const signupBtn = document.getElementById('signupBtn');
    const dashboard = document.getElementById('dashboard');
    const logoutBtn = document.getElementById('logoutBtn');

    function checkAuth() {
      const isLoggedIn = sessionStorage.getItem('isLoggedIn');
      const storedEmail = sessionStorage.getItem('userEmail');

      if (isLoggedIn) {
        loginBtn.style.display = 'none';
        signupBtn.style.display = 'none';
        dashboard.style.display = 'inline-block';  // Make sure dashboard button is visible
        logoutBtn.style.display = 'inline-block';  // Make sure logout button is visible
      } else {
        logoutBtn.style.display = 'none';
        dashboard.style.display = 'none';
        loginBtn.style.display = 'inline-block';
        signupBtn.style.display = 'inlink-block';
      }
    }

    checkAuth();  // Call checkAuth to update button visibility
    
    logoutBtn.addEventListener('click', function () {
      sessionStorage.removeItem('isLoggedIn');
      sessionStorage.removeItem('userEmail');
      checkAuth();
      window.location.reload();
    });
   });   
   </script>
    </nav>

    <!-- CometChat Widget Container -->
    <div id="cometchat"></div>

    <script
      type="text/javascript"
      src="https://unpkg.com/@cometchat/chat-sdk-javascript/CometChat.js"
    ></script>
    <script
      defer
      src="https://widget-js.cometchat.io/v3/cometchatwidget.js"
    ></script>
    <script>
      window.addEventListener("DOMContentLoaded", (event) => {
        let appID = "273007af6b1dd710";
        let region = "in";
        let appSetting = new CometChat.AppSettingsBuilder()
          .subscribePresenceForAllUsers()
          .setRegion(region)
          .autoEstablishSocketConnection(true)
          .build();
        CometChat.init(appID, appSetting).then(
          () => {
            console.log("Initialization completed successfully");
            const email = localStorage.getItem("userEmail");
            // 🔐 Check if user is not logged in
            if (!email) {
              alert("You must be logged in to access Saathi Rooms.");
              window.location.href = "login.html";
              return;
            }
            let authKey = "4f60e0dbc829182a47dd9a35fbd1310899c11b60";

            var UID =
              email.replace(/[@.]/g, "_").toLowerCase() + "_ehsaas_user";

            const name = email.split("@")[0];

            var user = new CometChat.User(UID);

            user.setName(name);

            CometChat.getLoggedinUser().then(
              (user) => {
                if (!user) {
                  CometChat.login(UID, authKey).then(
                    (user) => {
                      console.log("Login Successful:", { user });

                      //COMET CHAT WIDGET INITITALIZED
                      CometChatWidget.init({
                        appID: "273007af6b1dd710",
                        appRegion: "in",
                        authKey: "4f60e0dbc829182a47dd9a35fbd1310899c11b60",
                      }).then(
                        () => {
                          console.log("CometChatWidget initialized");

                          CometChatWidget.login({
                            uid: UID,
                          }).then(
                            () => {
                              console.log("User logged in");

                              CometChatWidget.launch({
                                widgetID:
                                  "b47a16fa-7e78-49a5-ae1a-95d24da89d1f",
                                target: "#cometchat",
                                roundedCorners: true,
                                height: "100%",
                                width: "100%",
                                defaultID: UID,
                                defaultType: "group",
                              });
                            },
                            (error) => {
                              console.error("Login failed:", error);
                            }
                          );
                        },
                        (error) => {
                          console.error("Initialization failed:", error);
                        }
                      );

                      //COMET CHAT WIDGET INITIALIZED
                    },
                    (error) => {
                      console.log("Login failed with exception:", { error });
                    }
                  );
                } else {
                  console.log("Already logged in : ", { user });

                  //COMET CHAT INITIALIZING
                  CometChatWidget.init({
                    appID: "273007af6b1dd710",
                    appRegion: "in",
                    authKey: "4f60e0dbc829182a47dd9a35fbd1310899c11b60",
                  }).then(
                    () => {
                      console.log("CometChatWidget initialized");

                      CometChatWidget.login({
                        uid: UID,
                      }).then(
                        () => {
                          console.log("User logged in");

                          CometChatWidget.launch({
                            widgetID: "b47a16fa-7e78-49a5-ae1a-95d24da89d1f",
                            target: "#cometchat",
                            roundedCorners: true,
                            height: "100%",
                            width: "100%",
                            defaultID: UID,
                            defaultType: "group",
                          });
                        },
                        (error) => {
                          console.error("Login failed:", error);
                        }
                      );
                    },
                    (error) => {
                      console.error("Initialization failed:", error);
                    }
                  );
                  //COMET CHAT INITIALIZED
                }
              },
              (error) => {
                console.log("Some Error Occured", { error });
              }
            );
          },
          (error) => {
            console.log("Initialization failed with error:", error);
          }
        );
      });
    </script>
  </body>
</html>
